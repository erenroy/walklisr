{% extends 'base.html' %}
{% load static %}
{% block title %}Confirm Subscription{% endblock %}

{% block content %}

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-k6RqeWeci5ZR/Lv4MR0sA0FfDOM5Vgq6Jd9Tl0QUAl9hi1swB7j4d0KqF0y5+shT" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/userdashboard.css' %}">
</head>
<body>

    <!-- Main Dashboard Code start here ---------------------------------------------------------------------------------------------- -->
	<div class="wrapper">
		
		<div class="main">
		
			<main class="content">
				<div class="container-fluid p-0">

					<h1 class="h3 mb-3"><strong>Analytics</strong> Dashboard</h1>

					<div class="row">
						<div class="col-xl-6 col-xxl-5 d-flex">
							<div class="w-100">
								<div class="row">
									<div class="col-sm-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Plan Name</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="truck"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">{{ subscription.plan.name }}</h1>
												<div class="mb-0">
													<!-- <span class="text-danger"> <i class="mdi mdi-arrow-bottom-right"></i> -3.65% </span> -->
													<span class="text-muted">Your current plan</span>
												</div>
											</div>
										</div>
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Managers</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="users"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">{{ subscription.plan.managers }}</h1>
												<div class="mb-0">
													<!-- <span class="text-success"> <i class="mdi mdi-arrow-bottom-right"></i> 5.25% </span> -->
													<span class="text-muted">Managers allowed </span>
												</div>
											</div>
										</div>
									</div>
									
									<div class="col-sm-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Price</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="dollar-sign"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">${{ subscription.plan.price }}</h1>
												<div class="mb-0">
													<span class="text-success"> <i class="mdi mdi-arrow-bottom-right"></i> 6.65% </span>
													<span class="text-muted">Your Plan Price</span>
												</div>
											</div>
										</div>
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Contacts</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="shopping-cart"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">{{ subscription.plan.contacts }}</h1>
												<div class="mb-0">
													<!-- <span class="text-danger"> <i class="mdi mdi-arrow-bottom-right"></i> -2.25% </span> -->
													<span class="text-muted">Contacts Allowed</span>
												</div>
											</div>
										</div>
										
									</div>
								</div>
							</div>
						</div>
						<div class="col-xl-6 col-xxl-5 d-flex">
							<div class="w-100">
								<div class="row">
									<div class="col-sm-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Polltakers </h5>
													</div>
							
													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="clipboard"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">{{ subscription.plan.poltakers }}</h1>
												<div class="mb-0">
													<!-- <span class="text-danger"> <i class="mdi mdi-arrow-bottom-right"></i> -3.65% </span> -->
													<span class="text-muted">Polltakers Allowed</span>
												</div>
											</div>
										</div>
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Surveys</h5>
													</div>
							
													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="bar-chart-2"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">{{ subscription.plan.surveys }}</h1>
												<div class="mb-0">
													<!-- <span class="text-success"> <i class="mdi mdi-arrow-bottom-right"></i> 5.25% </span> -->
													<span class="text-muted">Surveys Allowed</span>
												</div>
											</div>
										</div>
									</div>
							
									<div class="col-sm-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Plan Start Date</h5>
													</div>
							
													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="calendar"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">{{ subscription.start_date|date:"Y-m-d" }}</h1>
												<div class="mb-0">
													<!-- <span class="text-success"> <i class="mdi mdi-arrow-bottom-right"></i> 6.65% </span> -->
													<span class="text-muted">Plan Started On this</span>
												</div>
											</div>
										</div>
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Plan End Date</h5>
													</div>
							
													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="calendar"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">{{ subscription.expiration_date|date:"Y-m-d" }}</h1>
												<div class="mb-0">
													<!-- <span class="text-danger"> <i class="mdi mdi-arrow-bottom-right"></i> -2.25% </span> -->
													<span class="text-muted">Plan End Date</span>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							
							
						</div>
						


					
						
					</div>

					<div class="row">
						<div class="col-12 col-md-6 col-xxl-3 d-flex order-2 order-xxl-3">
							<div class="card flex-fill w-100">
								<div class="card-header">
									<h5 class="card-title mb-0">Survey Data Analysis</h5>
								</div>
								<div class="card-body d-flex">
									<div class="align-self-center w-100">
										<div class="py-3">
											<div class="chart chart-xs">
												<canvas id="chartjs-dashboard-pie"></canvas>
											</div>
										</div>
						
										<table class="table mb-0">
											<tbody>
												<tr>
													<td>Successful</td>
													<td class="text-end">{{ successful_count }} ({{ successful_percentage }}%)</td>
												</tr>
												<tr>
													<td>Pending</td>
													<td class="text-end">{{ in_progress_count }} ({{ in_progress_percentage }}%)</td>
												</tr>
												<tr>
													<td>Denied</td>
													<td class="text-end">{{ denied_count }} ({{ denied_percentage }}%)</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						
						<style>
							.chart {
								position: relative;
								height: 300px;
								width: 100% !important;
							}
						
							.table td {
								font-size: 14px;
								font-weight: 500;
								color: #333;
							}
						
							.table td.text-end {
								font-weight: 700;
								color: #007bff;
							}
						
							/* Custom animation styles */
							.chartjs-legend {
								display: flex;
								flex-direction: row;
								justify-content: space-between;
								margin-top: 10px;
							}
						</style>
						
						<script>
							document.addEventListener("DOMContentLoaded", function() {
								// Get real data from Django context variables
								var successfulCount = {{ successful_count }};
								var inProgressCount = {{ in_progress_count }};
								var deniedCount = {{ denial_count }};
								
								// Calculate percentages
								var totalCount = successfulCount + inProgressCount + deniedCount;
								var successfulPercentage = ((successfulCount / totalCount) * 100).toFixed(2);
								var inProgressPercentage = ((inProgressCount / totalCount) * 100).toFixed(2);
								var deniedPercentage = ((deniedCount / totalCount) * 100).toFixed(2);
								
								// Update the table dynamically
								document.querySelector('.table tbody tr:nth-child(1) td.text-end').textContent = successfulCount + " (" + successfulPercentage + "%)";
								document.querySelector('.table tbody tr:nth-child(2) td.text-end').textContent = inProgressCount + " (" + inProgressPercentage + "%)";
								document.querySelector('.table tbody tr:nth-child(3) td.text-end').textContent = deniedCount + " (" + deniedPercentage + "%)";
								
								// Pie chart with advanced features
								new Chart(document.getElementById("chartjs-dashboard-pie"), {
									type: "pie",
									data: {
										labels: ["Successful", "Pending", "Denied"],
										datasets: [{
											label: 'Survey Data',
											data: [successfulCount, inProgressCount, deniedCount],
											backgroundColor: [
												"rgba(40, 167, 69, 0.7)",  // Green for Successful
												"rgba(255, 193, 7, 0.7)",  // Yellow for In Progress
												"rgba(220, 53, 69, 0.7)"   // Red for Denied
											],
											hoverBackgroundColor: [
												"rgba(40, 167, 69, 1)",  // Green hover
												"rgba(255, 193, 7, 1)",  // Yellow hover
												"rgba(220, 53, 69, 1)"   // Red hover
											],
											borderWidth: 2,
											borderColor: "#ffffff"
										}]
									},
									options: {
										responsive: true,
										maintainAspectRatio: false,
										plugins: {
											legend: {
												position: 'top',
												labels: {
													font: {
														size: 14,
														weight: 'bold',
														family: 'Arial'
													}
												}
											},
											tooltip: {
												callbacks: {
													label: function(tooltipItem) {
														return tooltipItem.label + ": " + tooltipItem.raw + " surveys (" + tooltipItem.raw / totalCount * 100 + "%)";
													}
												},
												backgroundColor: 'rgba(0,0,0,0.7)',  // Dark background for tooltips
												titleFont: { size: 16, weight: 'bold' },
												bodyFont: { size: 14 }
											}
										},
										animation: {
											animateScale: true,
											animateRotate: true,
											duration: 1500,
											easing: 'easeOutElastic'  // Smooth and bouncy animation effect
										},
										cutoutPercentage: 75,
										borderColor: '#ffffff',
										borderWidth: 2
									}
								});
							});
						</script>
						
						
						<!-- <div class="col-12 col-md-12 col-xxl-6 d-flex order-3 order-xxl-2">
							<div class="card flex-fill w-100">
								<div class="card-header">

									<h5 class="card-title mb-0">Real-Time</h5>
								</div>
								<div class="card-body px-4">
									<div id="world_map" style="height:350px;"></div>
								</div>
							</div>
						</div> -->
						<div class="col-12 col-md-12 col-xxl-6 d-flex order-3 order-xxl-2">
							<div class="card flex-fill w-100">
								<div class="card-header">
									<h5 class="card-title mb-0">Survey Status (Last 7 Days)</h5>
								</div>
								<div class="card-body px-4">
									<canvas id="surveyChart" width="400" height="200"></canvas>
								</div>
								<div class="card-body">
									<p style="font-size: 18px; font-weight: bold; color: #4CAF50; margin-bottom: 10px; padding: 10px; background-color: #e8f5e9; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
										<strong>Completed Surveys:</strong> {{ successful_count }} surveys
									</p>
									<p style="font-size: 18px; font-weight: bold; color: #FF9800; margin-bottom: 10px; padding: 10px; background-color: #fff3e0; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
										<strong>In Progress Surveys:</strong> {{ in_progress_count }} surveys
									</p>
									<p style="font-size: 18px; font-weight: bold; color: #FF5722; margin-bottom: 10px; padding: 10px; background-color: #ffebee; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
										<strong>Denied Surveys:</strong> {{ denial_count }} surveys
									</p>
								</div>
								
							</div>
							
						</div>
						<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Prepare data from the backend
    const labels = {{ survey_labels|safe }};
    const successfulData = {{ successful_data|safe }};
    const inProgressData = {{ in_progress_data|safe }};
    const deniedData = {{ denied_data|safe }};
    
    // Set up the chart
    const ctx = document.getElementById('surveyChart').getContext('2d');
    const surveyChart = new Chart(ctx, {
        type: 'line',  // Choose the type of chart (line, bar, etc.)
        data: {
            labels: labels,
            datasets: [{
                label: 'Successful Surveys',
                data: successfulData,
                borderColor: 'green',
                fill: false,
                tension: 0.1
            }, {
                label: 'In Progress Surveys',
                data: inProgressData,
                borderColor: 'orange',
                fill: false,
                tension: 0.1
            }, {
                label: 'Denied Surveys',
                data: deniedData,
                borderColor: 'red',
                fill: false,
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
						<div class="col-12 col-md-6 col-xxl-3 d-flex order-1 order-xxl-1">
							<div class="card flex-fill">
								<div class="card-header">

									<h5 class="card-title mb-0">Calendar</h5>
								</div>
								<p style="margin-left: 10%; margin-right: 10%; color: #939ba2;
								font-size: 0.925rem;
								font-weight: 600">This date marks the latest update on your surveys and activities. Keep track of your progress and monitor ongoing surveys for the most current information. Stay informed and manage your tasks efficiently as you engage with today's data.</p>


								<div class="card-body d-flex">
									<div class="align-self-center w-100">
										<div class="chart">
											<div id="datetimepicker-dashboard"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-12 col-lg-8 col-xxl-9 d-flex">
							
							<div class="card flex-fill">
								<div class="card-header">

									<h5 class="card-title mb-0">Latest Surveys</h5>
								</div>
								<table class="table table-hover my-0">
									<thead>
										<tr>
											<th>Name</th>
											<th class="d-none d-xl-table-cell">Created At</th>
											<th class="d-none d-xl-table-cell">Survey Date</th>
											<th>Status</th>
											<!-- <th class="d-none d-md-table-cell">Assignee</th> -->
										</tr>
									</thead>
									<tbody>
										{% for survey in surveys %}
										<tr>
											<td>{{ survey.title }}</td>
											<td class="d-none d-xl-table-cell">{{ survey.created_at|date:"Y-m-d" }}</td>
											<td class="d-none d-xl-table-cell">{{ survey.survey_date }}</td>
											<td><span class="badge bg-success">{{ survey.status }}</span></td>


											<!-- <td class="d-none d-md-table-cell">Vanessa Tucker</td> -->
										</tr>
										{% endfor %}
										<tr>
										
										
										
										
									</tbody>
								</table>
							</div>
						</div>
						 <div class="col-12 col-lg-4 col-xxl-3 d-flex">
							<div class="card flex-fill w-100">
								<div class="card-header">
									<h5 class="card-title mb-0">Today's Movement</h5>
								</div>
								<div class="card-body py-3">
									<div class="chart chart-sm">
										<canvas id="todayMovementChart"></canvas>
									</div>
								</div>
							</div>
						</div> 

						<!-- User Details Start  -->
						<div id="account-info">
							<h2 class="section-header">Account Information</h2>
							<div class="info-grid">
								<div class="info-card">
									<h3>Username</h3>
									<strong>{{ username }}</strong>
								</div>
								<div class="info-card">
									<h3>Email</h3>
									<strong>{{ user_email }}</strong>
								</div>
							</div>
						</div>
						
						<div class="dashboard-container">
							<!-- Profile Information -->
							{% if profile %}
								<div id="profile-info" class="card-section">
									<h2 class="section-header"><i class="fas fa-user"></i> Profile Information</h2>
									<div class="info-grid">
										<div class="info-card">
											<h3>First Name</h3>
											<strong>{{ profile.first_name }}</strong>
										</div>
										<div class="info-card">
											<h3>Last Name</h3>
											<strong>{{ profile.last_name }}</strong>
										</div>
										<div class="info-card">
											<h3>Phone Number</h3>
											<strong>{{ profile.phone_number }}</strong>
										</div>
										<div class="info-card">
											<h3>Country</h3>
											<strong>{{ profile.country }}</strong>
										</div>
										<div class="info-card">
											<h3>City</h3>
											<strong>{{ profile.city }}</strong>
										</div>
										<div class="info-card">
											<h3>Street</h3>
											<strong>{{ profile.street }}</strong>
										</div>
										<div class="info-card">
											<h3>Zip Code</h3>
											<strong>{{ profile.zip_code }}</strong>
										</div>
									</div>
								</div>
							{% else %}
								<p>No profile information available.</p>
							{% endif %}
							<div class="d-flex justify-content-center mt-5">
								<a href="{% url 'edit_user_profile' %}" class="btn btn-primary btn-lg px-5 py-3 shadow-lg text-white hover-effect">Edit Details </a>
							</div>
							
						</div>
<style>
.dashboard-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.section-header {
    font-size: 24px;
    margin-bottom: 20px;
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
    color: #007bff;
    display: flex;
    align-items: center;
}

.section-header i {
    margin-right: 10px;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.info-card {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.info-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.info-card h3 {
    font-size: 18px;
    margin-bottom: 10px;
    color: #007bff;
}

.info-card strong {
    font-size: 16px;
    color: #333;
}

.card-section {
    margin-bottom: 40px;
}

</style>
						<!-- user details end  -->

					
						
						
					
					</div>

					

				</div>

				
			</main>

			
		</div>
	</div>

<!-- 
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			var ctx = document.getElementById("chartjs-dashboard-line").getContext("2d");
			var gradient = ctx.createLinearGradient(0, 0, 0, 225);
			gradient.addColorStop(0, "rgba(215, 227, 244, 1)");
			gradient.addColorStop(1, "rgba(215, 227, 244, 0)");
			// Line chart
			new Chart(document.getElementById("chartjs-dashboard-line"), {
				type: "line",
				data: {
					labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
					datasets: [{
						label: "Sales ($)",
						fill: true,
						backgroundColor: gradient,
						borderColor: window.theme.primary,
						data: [
							2115,
							1562,
							1584,
							1892,
							1587,
							1923,
							2566,
							2448,
							2805,
							3438,
							2917,
							3327
						]
					}]
				},
				options: {
					maintainAspectRatio: false,
					legend: {
						display: false
					},
					tooltips: {
						intersect: false
					},
					hover: {
						intersect: true
					},
					plugins: {
						filler: {
							propagate: false
						}
					},
					scales: {
						xAxes: [{
							reverse: true,
							gridLines: {
								color: "rgba(0,0,0,0.0)"
							}
						}],
						yAxes: [{
							ticks: {
								stepSize: 1000
							},
							display: true,
							borderDash: [3, 3],
							gridLines: {
								color: "rgba(0,0,0,0.0)"
							}
						}]
					}
				}
			});
		});
	</script> -->
	<!-- <script>
		document.addEventListener("DOMContentLoaded", function() {
			// Pie chart
			new Chart(document.getElementById("chartjs-dashboard-pie"), {
				type: "pie",
				data: {
					labels: ["Chrome", "Firefox", "IE"],
					datasets: [{
						data: [4306, 3801, 1689],
						backgroundColor: [
							window.theme.primary,
							window.theme.warning,
							window.theme.danger
						],
						borderWidth: 5
					}]
				},
				options: {
					responsive: !window.MSInputMethodContext,
					maintainAspectRatio: false,
					legend: {
						display: false
					},
					cutoutPercentage: 75
				}
			});
		});
	</script> -->
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			// Bar chart
			new Chart(document.getElementById("chartjs-dashboard-bar"), {
				type: "bar",
				data: {
					labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
					datasets: [{
						label: "This year",
						backgroundColor: window.theme.primary,
						borderColor: window.theme.primary,
						hoverBackgroundColor: window.theme.primary,
						hoverBorderColor: window.theme.primary,
						data: [54, 67, 41, 55, 62, 45, 55, 73, 60, 76, 48, 79],
						barPercentage: .75,
						categoryPercentage: .5
					}]
				},
				options: {
					maintainAspectRatio: false,
					legend: {
						display: false
					},
					scales: {
						yAxes: [{
							gridLines: {
								display: false
							},
							stacked: false,
							ticks: {
								stepSize: 20
							}
						}],
						xAxes: [{
							stacked: false,
							gridLines: {
								color: "transparent"
							}
						}]
					}
				}
			});
		});
	</script>
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			var markers = [{
					coords: [31.230391, 121.473701],
					name: "Shanghai"
				},
				{
					coords: [28.704060, 77.102493],
					name: "Delhi"
				},
				{
					coords: [6.524379, 3.379206],
					name: "Lagos"
				},
				{
					coords: [35.689487, 139.691711],
					name: "Tokyo"
				},
				{
					coords: [23.129110, 113.264381],
					name: "Guangzhou"
				},
				{
					coords: [40.7127837, -74.0059413],
					name: "New York"
				},
				{
					coords: [34.052235, -118.243683],
					name: "Los Angeles"
				},
				{
					coords: [41.878113, -87.629799],
					name: "Chicago"
				},
				{
					coords: [51.507351, -0.127758],
					name: "London"
				},
				{
					coords: [40.416775, -3.703790],
					name: "Madrid "
				}
			];
			var map = new jsVectorMap({
				map: "world",
				selector: "#world_map",
				zoomButtons: true,
				markers: markers,
				markerStyle: {
					initial: {
						r: 9,
						strokeWidth: 7,
						stokeOpacity: .4,
						fill: window.theme.primary
					},
					hover: {
						fill: window.theme.primary,
						stroke: window.theme.primary
					}
				},
				zoomOnScroll: false
			});
			window.addEventListener("resize", () => {
				map.updateSize();
			});
		});
	</script>
<script>
	document.addEventListener("DOMContentLoaded", function() {
		var date = new Date();  // Get today's date
		var defaultDate = date.getUTCFullYear() + "-" + (date.getUTCMonth() + 1).toString().padStart(2, '0') + "-" + date.getUTCDate().toString().padStart(2, '0');
		document.getElementById("datetimepicker-dashboard").flatpickr({
			inline: true,
			prevArrow: "<span title=\"Previous month\">&laquo;</span>",
			nextArrow: "<span title=\"Next month\">&raquo;</span>",
			defaultDate: defaultDate
		});
	});
</script>
<script>
	// Initialize localStorage with today's movement data if it's not already set
	if (!localStorage.getItem('todayMovementData')) {
		localStorage.setItem('todayMovementData', JSON.stringify({
			date: new Date().toISOString().split('T')[0], // Today's date (YYYY-MM-DD)
			visits: 0,
			timeSpent: 0
		}));
	}

	// Track page visits and time spent
	function trackPageVisit() {
		const movementData = JSON.parse(localStorage.getItem('todayMovementData'));

		// Check if the stored date is today's date
		const currentDate = new Date().toISOString().split('T')[0];
		if (movementData.date !== currentDate) {
			// Reset data for a new day
			localStorage.setItem('todayMovementData', JSON.stringify({
				date: currentDate,
				visits: 0,
				timeSpent: 0
			}));
		}

		// Increment the visit count
		movementData.visits += 1;

		// Save the updated data back to localStorage
		localStorage.setItem('todayMovementData', JSON.stringify(movementData));

		// Track time spent on the page
		let startTime = localStorage.getItem('pageStartTime');
		if (!startTime) {
			startTime = Date.now();
			localStorage.setItem('pageStartTime', startTime);
		}

		// Calculate and store time spent when the user leaves the page
		window.addEventListener('beforeunload', () => {
			const timeSpent = (Date.now() - startTime) / 1000; // Time spent in seconds
			movementData.timeSpent += timeSpent;

			// Save the updated movement data
			localStorage.setItem('todayMovementData', JSON.stringify(movementData));
			localStorage.removeItem('pageStartTime');
		});
	}

	// Call the trackPageVisit function when the page loads
	trackPageVisit();

	// Function to update the chart with today's movement data
	function updateChart() {
		const movementData = JSON.parse(localStorage.getItem('todayMovementData'));

		// Get today's visit and time data
		const visits = movementData.visits;
		const timeSpent = movementData.timeSpent;

		// Labels for the chart (No monthly data, just "Today's Movement")
		const labels = ['Visits', 'Time Spent (s)'];
		const data = [visits, timeSpent];

		// Check if the chart element exists and is ready
		const ctx = document.getElementById('todayMovementChart').getContext('2d');
		if (ctx) {
			// Create the chart with unique ID and style
			new Chart(ctx, {
				type: 'line', // Line chart
				data: {
					labels: labels,
					datasets: [{
						label: 'Today\'s Movement',
						data: data,
						backgroundColor: (context) => {
							const gradient = ctx.createLinearGradient(0, 0, 0, 400);
							gradient.addColorStop(0, 'rgba(0, 123, 255, 0.1)');
							gradient.addColorStop(1, 'rgba(0, 123, 255, 0.4)');
							return gradient;
						},
						borderColor: 'rgba(0, 123, 255, 1)',
						borderWidth: 2,
						tension: 0.4, // Smooth line curve
						fill: true,
					}],
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						y: {
							beginAtZero: true,
							ticks: {
								stepSize: 1,
								color: '#6c757d', // Gray tick labels
								font: {
									size: 12,
								},
							},
							grid: {
								color: '#e0e0e0', // Light gray grid lines
							},
						},
						x: {
							ticks: {
								color: '#6c757d', // Gray tick labels
								font: {
									size: 12,
								},
							},
							grid: {
								display: false, // Hide grid on X-axis
							},
						},
					},
					plugins: {
						tooltip: {
							backgroundColor: 'rgba(0, 123, 255, 0.8)', // Blue background for tooltip
							titleColor: '#fff',
							bodyColor: '#fff',
							borderColor: '#007bff',
							borderWidth: 1,
							cornerRadius: 4,
							padding: 10,
						},
					},
				},
			});
		}
	}

	// Call the function to update the chart after the page loads
	window.onload = function () {
		updateChart();
	};
</script>

    <!-- Main Dashboard Code End here ---------------------------------------------------------------------------------------------- -->

 

    
<style>
    
.label-title{
    margin-right: 24%;
}

@media screen and (max-width: 800px) {
    #main {
    transition: margin-left .5s;
    padding: 0px;
    margin-left: 250px;
}
.label-title {
    margin-right: 0%;
}
}

@media screen and (max-width: 500px) {
.search-bar {
    gap: 0px;
    padding: 0px;
}
.submit-btn{
    margin-left: 30%;
}
}
@media screen and (max-width: 500px) {
    .navbar-logo img {
    width: 82px;
    margin-left: -20px;
}
.navbar-welcome h2 {

    margin-left: -20%;
    font-size: 18px;
}
}
@media screen and (max-width: 380px) {
    .navbar-logo img {
    width: 75px;
    margin-left: -30px;
}
.navbar-welcome h2 {
    font-size: 12px;
    color: #000000;
    font-weight: bold;
}
}
</style>
<style>
    .container {
        padding-top: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
    position: relative;
    overflow: hidden;
    width: 4000px;
    max-width: 100%;
    min-height: 480px;
}
</style>
<link rel="stylesheet" href="{% static 'css/all-responsive-page.css' %}">
<script src="{% static 'js/userdashboard.js' %}"></script>
<!-- Last Responsive code of new start here new side navbar  START ----------------------------------------------------------------- -->


<style>
    body{
        background-color: white;
    }
    .responsive-wrapper {
    max-width: 4880px;
    margin-left: auto;
    margin-right: auto;
}

.responsive-wrapper {
    width: 100%;

}
.main {
    padding-top: 0rem;
    border: none;
}
#basemain{
    display: none;
}
.wrapper {
    margin-top: -12%;
}

</style>
<style>
	    .content {
        width: 95%;
        margin: 0 auto;
    }
    .content.full-width {
        width: 100%;
    }
    @media (max-width: 800px) {
        .content {
            width: 100%;
        }
    }
	.col-xxl-5 {
        flex: 0 0 auto;
        width: 50%;
    }


	/* Button Styles */
.hover-effect {
    transition: all 0.3s ease-in-out;
    border-radius: 20px; /* Apply a border-radius of 20px for rounded corners */
}

.hover-effect:hover {
    background-color: #0056b3; /* Darker shade of blue for hover effect */
    transform: scale(1.05); /* Slightly enlarge the button on hover */
    box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1); /* Adding a subtle shadow on hover */
}

.btn-lg {
    font-size: 1.25rem; /* Increase font size for a larger button */
    padding: 15px 40px; /* Increase padding for a more prominent button */
}

.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
}

.btn-primary:hover {
    background-color: #0056b3;
    border-color: #004085;
}
.wrapper {
    margin-top: -5%;
}
</style>
<!-- Last Responsive code of new start here new side navbar END ----------------------------------------------------------------- -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .content {
    width: 90%;
}
@media (max-width: 1000px) {
    .content {
        width: 100%;
    }
}
</style>
   {% endblock %}
